{
    "targets": [
        {
            "name": "headers",
            "type": "jinja2",
            "input": {
                "template": "{{ target['@files'].read_text('headers.json') }}",
                "kargs": {
                    "chii_auth": "{{ chii_auth }}"
                }
            }
        },
        {
            "name": "update_cookie",
            "type": "request",
            "input": {
                "request": {
                    "uri": "http://bgm.tv",
                    "headers": {
                        "@type": "call",
                        "name": "json_decode",
                        "args": ["{{ target.headers }}"]
                    }
                }
            }
        },
        {
            "name": "set_cookie",
            "type": "set_cookie",
            "input": {
                "request": {
                    "uri": "http://bgm.tv/pm",
                    "headers": {
                        "@type": "call",
                        "name": "json_decode",
                        "args": ["{{ target.headers }}"]
                    }
                },
                "set_cookie": "{{ target.update_cookie.headers['Set-Cookie'] }}"
            }
        },
        {
            "name": "get_html",
            "type": "request",
            "input": {
                "request": "{{ target.set_cookie }}"
            }
        },
        {
            "name": "decode",
            "type": "base64_decode",
            "input": {
                "text": "{{ target.get_html.body }}"
            }
        },
        {
            "name": "transform",
            "type": "xslt",
            "input": {
                "html": "{{ target.decode }}",
                "xslt": "{{ target['@files'].read_text('bgm.xslt') }}"
            }
        }
    ],
    "files": [
        {
            "name": "bgm.xslt",
            "path": "../targets/test/bgm.xslt"
        },
        {
            "name": "headers.json",
            "path": "./headers.json"
        }
    ]
}
